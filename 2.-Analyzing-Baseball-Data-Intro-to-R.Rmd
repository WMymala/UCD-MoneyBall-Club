---
title: "2.-Analyzing-Baseball-Data-Lahman_Database"
author: "Walter Mymala, Mihir Kulkarni"
output: html_document
---

Link for the book if you really want to read it (totally optional): https://libgen.is/book/index.php?md5=AA1AE52B2BA2B01497FACAD2B7E4807F

# Intro

Lahman is a database w/ pitching, hitting, and fielding statistics for the entire history of professional baseball from 1871 to the current. csvs in Lahman on pp. 4 Analyzing Baseball Data.

# 2.3 Tidyverse

```{r}
## install.packages("Lahman"); Install a library. Libraries have additional fxns and tricks that regular R cannot run
library(Lahman) # runs librar(ies) in file
library(tidyverse) # important library for data analysis. dplyr good for extracting data and ggplot good for visualizing observations
```

```{r}
# piping fxn (%>%) allows us to write neater code for nested functions
Master %>% head(1) # biographic info. head(Master, 1) without using piping fxn
Batting %>% head(5) # .csv with seasonal batting stats. Try to run Pitching .csv and Fielding .csv on your own
Teams %>% head(5) # seasonal data at the team level going back to 1871.
```

# 2.4 Data Frames

```{r}
spahn <- read.csv("/Users/yeezywally_510/Desktop/MoneyBall/spahn.csv") # read dataset
#View(spahn_data)
class(spahn) # dataframe (df) - rectangular table of data, rows usually correspond to different observations, and columns of the table correspond to different variables collected on the observations.
```

dplyr functions: https://cran.r-project.org/web/packages/dplyr/vignettes/dplyr.html
```{r}
spahn %>% slice(1:3) %>% select(1:10) # == select(slice(spahn, 1:3), 1:10); shows first three rows and columns 1 though 10 of spahn df
spahn %>% slice(1:10) %>% select(Age, W, L, ERA) # custom select columns 
```

```{r}
# get 5 number summary stats for Spahn's ERA
spahn %>%
  summarize(LO = min(ERA),
            QL = quantile(ERA, .25),
            M = median(ERA), QU = quantile(ERA, .75), HI = max(ERA))

# Find age when Spahn had lowest ERA
spahn %>% filter(ERA == min(ERA)) %>% select(Age)
```

$$FIP = {13HR+3BB-2K}/IP$$ - FIP (Field Independent Pitching) scales ERA. "Measurement of a pitcherâ€™s performance that strips out the role of defense, luck, and sequencing, making it a more stable indicator of how a pitcher actually performed over a given period of time than a runs allowed based statistic that would be highly dependent on the quality of defense played behind him" (Fangraphs). It's also a future ERA estimator for pitchers.
```{r}
# manipulations
spahn %>%
  mutate(FIP = (13 * HR + 3 * BB - 2 * SO) / IP) -> spahn # add new column variable to df with mutate()

# see which years Spahn had lowest FIP
spahn %>%
  arrange(FIP) %>%
  select(Year, Age, W, L, ERA, FIP) %>%
  head() # his best FIPs were during the middle of his career

# mutate TOT (multiple teams) value from Tm (Team) column so only 2 unique values (factors) in the column 
# spahn <- spahn %>%
#  mutate(Tm = factor(Tm, levels = c("BSN", "MLN")))
 
# compare Spahns stats when he played in Boston vs. in Milwaukee
 spahn %>%
  group_by(Tm) %>%
  summarize(mean_W.L = mean(W.L, na.rm = TRUE),
            mean_ERA = mean(ERA),
            mean_WHIP = mean(WHIP),
            mean_FIP = mean(FIP))
```

